

# 遺伝的アルゴリズム(GA)

https://www.slideshare.net/kzokm/genetic-algorithm-41617242

上記のスライドをノートにする。



## What's GA

生物進化における遺伝と適者生存による自然淘汰の仕組みをソフトウェア的に模すことで複雑な問題に対する最適解を探索する手法.

ある命題に対する解の候補を _遺伝子(gene)_ とその集合体である _染色体(chromosome)_ で表現した _個体(individal)_ を複数用意し, _適応度(fitness)_ の高い個体を優先して _交叉(crossover)_ , _突然変異(mutation)_ などの操作を繰り返しながら最適解の探索を行う.

## Merits of GA

評価関数の可微分性や単峰性などの知識がない場合であっても適応可能.

必要とされる条件は,評価関数の _全順応性_ と探索空間が _位相(topology)_ を持っていること.

遺伝子の表現の仕方によって, 組合せ最適化問題やNP困難な問題などの様々な問題に対する適用が可能.

## Genetic Glossary

- 遺伝子(gane)

個体の形質を表すための基本となる構成要素

- 染色体(chromosome)

複数の遺伝子の集まり

- 個体(individual)

1つまたは複数の染色体によって表現される自律的な個命題に対する解の候補

- 集団(population)

様々な個体の集まり

- 遺伝子座(locus)

染色体上における各遺伝子の位置

- 対立遺伝子(allele)

ある遺伝子座において遺伝子が取りうる別の値

- 遺伝子型(genotype)

遺伝子を用いた内部表現(ex. AGATCG-YWZXZ)

- 表現型(phenotype)

遺伝子によって発現する形質の外部表現.

- 符号化(encoding)

表現型から遺伝子型への変換

(ex. くちばし＝赤・三角 -> AGATCG-YWZXZ)

- 復号化(decoding)

符号化の反対. 遺伝子型から表現型への変換.

## Genetic Algorithms

1. 解を表現する符号化方法を決定する.

2. N個のランダムな個体を含む集団を作成する. これを「**現世代**」と呼ぶ.

3. N個の個体を格納可能な集団を用意する. これを「**次世代**」と呼ぶ.

4. 評価関数を用いて, 現世代の各個体の適応度をそれぞれ計算する.

5. ある確率で次の３つの操作を行い, その結果を次世代に保存する.

   1. 現世代から2つの個体を選択する.
   2. 選択された個体を用いて交叉を行い, 子孫(offspring)を生成する.
   3. 交叉によって生成された子孫に対して, 突然変異を適用する.

6. 次世代の個体数がN個になるまで５の操作を繰り返す.

7. 次世代を現世代に移行し, 命題が収束するまで３〜６の手順を繰り返す. この結果を「最終世代」と呼ぶ.

   命題の収束を判定する方法として, 以下のような場合が用いられる.

   - 集団中の最大適応度が, ある閾値より大きくなった場合.
   - 集団全体の平均適応度がある閾値(しきいち)より大きくなった場合.
   - 集団の適応度増加率が, ある閾値以下の世代が一定期間続いた場合.
   - 世代交代の回数が規定の最大世代数に達した場合.

8. 最終世代の中で最も適応度の高い個体を「解」として出力する.

## Chromosome Encodings

解の特徴を遺伝子として表現する.

- バイナリエンコーディング(binary encoding)

  各遺伝子を0, 1のビットとして表現する符号化方法

  - 染色体A: 00101010
  - 染色体B: 10110110

- 順列エンコーディング(permutation encoding)

  各遺伝子の順序を示す数字として表現する符号化方法

  - 染色体A: 276418359
  - 染色体B: 461957382

  巡回セールスマン問題や仕事の順序などの並べ替え問題の表現に用いられる

- 実数値エンコーディング(real encoding)

  各遺伝子を数値（または文字）として表現する符号化方法

  - 染色体A: 0.51 2.83 3.12 1.50
  - 染色体B: AGTCATGCAGCCATTTA
  - 染色体C: 前進 前進 右 後退 左

  実数値データなど, バイナリエンコーディングでは表現が難しい場合に用いる

- 木構造エンコーディング(tree encoding)

  染色体を１本の紐（配列）ではなく, 木構造データとして表現する符号化方法

  https://gyazo.com/122020db0cb63cf07d399fa4f77e6770

  遺伝的プログラミング(GP)や進化的プログラミング(EP)などの表現に用いられる

## Encoding Examples

### ナップザック問題(Knapzack Problem)

容量 $C$ のナップザックが１つと、各々の価値が $P_i$ ,  容量が $C_i$ であるところの $n$ 個の品物 $E_i$ が与えられた時, $C$ を超えない範囲でいくつかの品物をナップザックに詰め, 入れた品物の価値の和を最大化するにはどの品物を選べば良いか？

#### バイナリエンコーディングで表現してみる

$n$ 個の荷物 $->$ 遺伝子長 $(L) $= $n$ 

$i$番目の荷物 $->$ 遺伝子座$(p)$ = $i$

荷物$E_i\UTF{200B}$を入れる $->\UTF{200B}$ 遺伝子$[i]\UTF{200B}$ = $1\UTF{200B}$

荷物$E_i\UTF{200B}$を入れない $->\UTF{200B}$ 遺伝子$[i]\UTF{200B}$ = $0\UTF{200B}$

適応度 $->$ 持っている荷物の総価値

| 荷物                 | $E_1$ | $E_2$ | $E_3$ | $E_4$ | $E_5$ | $E_6$ | $E_7$ | $…$  | $E_n$ |
| -------------------- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ---- | ----- |
| 重さ $(C_i) \ \ Kg $ | 0.9   | 1.1   | 0.7   | 1.4   | 0.5   | 1.3   | 1.1   |      | 1.6   |
| 価値 $(P_i) \ \$ $   | 1.0   | 1.3   | 0.9   | 1.5   | 0.5   | 1.1   | 1.2   |      | 1.4   |
| 遺伝子表現           | 1     | 0     | 0     | 1     | 0     | 1     | 0     | $…$  | 0     |
| 重さ $<= C \ \\UTF{00A0}Kg$   | 0.9   |       | +     | 1.4   | +     | 1.3   | +     | $…$  |       |
| 適応度               | 1.0   |       | +     | 1.5   | +     | 1.1   | +     | $…$  |       |



### 循環セールスマン問題(Travelling Salesman Problem)

$n$個の都市$C_i$と, それぞれの都市間の距離$D_{i,j}$が与えられている時,最初の都市を出発し, 全ての都市を経由して, 同じ都市に戻ってくるルートのうち, 最短のルートを求めよ.



#### 順列エンコーディングで表現してみる

$n$個の都市 $->$ 遺伝子長 $(L) = n$

$i$番目に訪れる $->$ 遺伝子座$(p) = i$

都市$C_x$ $->$ 遺伝子$[i] = x$

適応度 $->$ 循環ルートの総距離

| ルート             | $1$       | $2$       | $3$       | $4$       | $5$       | $6$       | $7$       | $…$  | $n$       |
| ------------------ | --------- | --------- | --------- | --------- | --------- | --------- | --------- | ---- | --------- |
| 訪れる都市         | $C_5$     | $C_8$     | $C_2$     | $C_7$     | $C_9$     | $C_1$     | $C_3$     |      | $C_4$     |
| 次の都市までの距離 | $D_{5,8}$ | $D_{8,2}$ | $D_{2,7}$ | $D_{7,9}$ | $D_{9,2}$ | $D_{1,3}$ | $D_{3,x}$ |      | $D_{4,5}$ |
| 遺伝子表現         | 5         | 8         | 2         | 7         | 9         | 1         | 3         | $…$  | 4         |

適応度   $\frac{1}{D_{5,8}+D_{8,2}+D_{2,7}+D_{7,9}+D_{9,2}+D_{1,3}+D_{3,x}+$…$+D_{4,5}}$

## Genetic Operations,Selection, Crossover, Mutation

- **繁殖(reproduction)**
  - **選択(selection)** $->$**交叉(crassover)** $->$ **突然変異(mutation)** $->$ **選択(selection)** $->$ **交叉(crossover)** $->$  $...$

- **選択(selection)**

  適応度に基づいて, 個体を増やしたり減らしたりするための対処を選び出す操作.

  生物の自然淘汰をモデル化したもの.

  - **ルーレット方式(roulette wheel selection)**

    集団をルーレット盤に見立て, ランダムな選択を行う方式.

    各個体の適応度が, ルーレット盤の面積と比例しており, 適応度が高い染色体ほど選ばれる確率が高くなる.

    https://gyazo.com/055873647fea2301ec8ec6e25004cfe5

    $p_i = \frac{f(i)}{\Sigma^N_{n=1}f(n)}$

    $p_i := $ある個体が選択される確率

    $f(i) :=$個体の適応度,  $N :=$集団サイズ

    適応度が正であることが前提.

    個体間の適応度の差が大きい場合, 適応度の高い個体の選ばれる確率が高くなりすぎ, 局所的な最適解への初期収束の原因となる.

  - **ランキング方式(ranking selection)**

    ルーレット方式の変形.

    適応度によって各個体のランク付けを行い, 「１位なら確率$p_1$, ２位なら確率$p_2$, ・・・」と_事前に決められた確率を適用_する方式

    https://gyazo.com/5ee2a8a6d9902092d41b772526f6b53d

    個体間の適応度の差が選択確率に影響されないが, 適応度に差がない個体であっても選択確率に大きな差が生じる可能性がある.

    ランク付けを行うためには世代毎にソートを行うことが必要.

  - トーナメント方式(tournament selection)

    予め決めた個体数（トーナメントサイズ）をランダムに抽出し, その中で最も適応度の高い個体を選択する方式.

    トーナメントサイズを変更することで, 選択圧をコントロールすることが可能.

    トーナメントサイズを大きくすることで選択圧を高めることができるが, 初期収束の原因となる.

  - エリート主義(elitism)

    予め決めた個数の, 最も適応度の高い個体をそのまま次世代にコピーする.

    世代間で適応度の最大値が下がらないことが保証される.

    エリートの遺伝子が集団の中で広まりすぎて, 解の多様性が失われる.

- __交叉(crossover)__

  選ばれた２つの個体の遺伝子の一部を入れ替える操作.

  生物の交配をモデル化したもの.

  - 交叉確率$(p_c)$

    各々の染色体において, 交叉が発生する確率.

    通常, 80~95%として設定する.

  - 具体的な交叉方式

    - 一点交叉(single point crossover)

      遺伝子が交叉する場所(交叉点)をランダムに決定し, その場所より後ろの遺伝子を入れ替える.

      効率が低いため, 現在はあまり用いられていない.

    - 二点交叉(two-point crossover)

      ２つの交叉点をランダムに決定し, その間の遺伝子を入れ替える.

    - 多点交叉(multi-point crossover)

      ３つ以上の交叉点をもつ方法. 二点交叉や一様交叉より良い値が得られることがほとんどないため, あまり用いられていない.

    - 一様交叉(uniform crossover)

      各遺伝子のそれぞれを所定の確率(通常は1/2)で入れ替える.

      https://gyazo.com/4a5873f0f741f36fad8afbf859c04da2

      二点交叉が得意とする問題を苦手とし, 逆の性質を示す.

      ヒッチハイキング問題への対策として用いられる.

  - 順列エンコーディングに対応した交叉方式

    $->$ 同じ遺伝子が重複しないこと

    - 循環交叉(cycle crossover; CX)

      双方の親から重複しない組み合わせを選んで, 遺伝子の一部ずつを受け継ぐ.

      https://gyazo.com/25de0f09dda0eb9c85d803d355a34f23

    - 順序交叉(order crossover; OX)

      片方の親からは一部をそのまま受け継ぎ, 残りの部分についてはもう片方の親から相対的な順序を受け継ぐ.

      https://gyazo.com/cf499fc969dccf7d2d3a438acf6efd25

    - 一様順序交叉(order-based crossover; OX2)

      一様に選んだ遺伝子座について一方の親の遺伝子の出現順序に従って, 他方の親の遺伝子を並べ替えたものを受け継ぐ

      https://gyazo.com/059e72091dc8f4ba485ea31665bbe0d6

    - 一様位置交叉(position-based crossover; POX)

      一様に選んだ遺伝子を入れ替え, 残りの遺伝子については親と同じ相対順序になるように配置する.

      https://gyazo.com/104991fdc167d9f1ba4e3b2a28851084

    - 部分写像交叉(partially mapped crossover; PMX)

      片方の親$P_1$からは一部をそのまま受け継ぎ, 残りの部分についてはもう片方の親$P_2$から重複しない遺伝子をそのまま受け継ぐ.

      重複する遺伝子については, $P_1$上で該当する遺伝子が占める遺伝子座を求め,  $P_2$上の同じ遺伝子座に存在する遺伝子を受け継ぐ.

      https://gyazo.com/65c0400bdbff30bfc01980cb2364c7bb

    - サブツアー交換交叉(subtour exchange crossover; SXX)

      それぞれの親の間である共通する数字の組み合わせからなる部分順列が存在する場合に, それを交換する. さらに入れ替えた部分順列を逆にしたものを含め, 合計4個の子を生成する.

      https://gyazo.com/d78ff723da8edc8c2e0d971a3a392be0

    - 辺組換え交叉(edge recombination crossover; ERX)

      順列のつながり(辺)に着目した交叉方法. 双方の親が共通して保有する辺をなるべく多く受け継ぐように子を生成する.

      https://gyazo.com/624c2e6e447691df12f0c9450405c8cc

    - 枝組立て交叉(edge assembly crossover; EAX)

      両親のいずれかが保有する辺のみを用いて複数のサブツアーに分割された不完全解を生成する.

      サブツアー間を, なるべく短い辺を用いて接続し直すことで完全解を含む子を生成する.

      https://gyazo.com/1b2cdeb9a03b58247ed0c6bb68f013f0

      経路問題の適用として, 計算コストと制度の両面から, 現時点において最も優れた方法とされている.

  - その他交叉方式

    - 算術交叉
    - 平均化交叉
    - ブレンド交叉
    - 単峰性正規分布交叉
    - シンプレックス交叉

- __突然変異(mutation)__

  個体の遺伝子の一部をランダムに変化させる.

  生物における突然変異をモデル化したもの.

  局所解に陥ることを防ぐ効果がある.

  - 変異確率($P_n$)

    各々の染色体において, 突然変異が発生する確率.

    通常, 0.1% ~ 1.0%, 高くても数%として設定する.

    各区率が低すぎると局所会に陥りやすくなり, 高すぎるとランダム探索に近づいて解が収束しにくくなる.

  - 置換(substitution)

    ランダムに選ばれた遺伝子を対立遺伝子に置き換える.

    https://gyazo.com/373f62ef9c03f7e2b596d2291736ae21

  - 摂動(perturbation)

    ランダムに選ばれた遺伝子の値に微量値を加算(または減算)する.

    https://gyazo.com/2ca1405a610539e81ff1d8983300575e

  - 交換(swap)

    ランダムに選ばれた2つの遺伝子を入れ替える.

    https://gyazo.com/3c0f874dfa2e6addcf3cee965660084a

  - 逆位(inversion)

    ランダムに選ばれた2点間の遺伝子を逆順に並び替える.

    https://gyazo.com/279a26716f6dd2b490b2c066814a4bcb

  - 攪拌(scramble)

    ランダムに選ばれた2点間の遺伝子をランダムに並び替える.

    https://gyazo.com/2038af6dc7720fa39adf10f0dd43322a

  - 転座(translocation)

    ランダムに選ばれた2点間の遺伝子を別の遺伝子座に移動する.

    https://gyazo.com/54b474579ae7d8114fddc6b5fa8eb9ad

  - 重複(duplication)

    ランダムに選ばれた2点間の遺伝子を別の遺伝子座に複製する.

    https://gyazo.com/dc867504eb1612e4bfcb9766738f9120

  - 挿入(insertion)

    ランダムに選ばれた場所に任意の遺伝子を挿入する.

    https://gyazo.com/06e69dad44509589bf3e4690015344dd

  - 欠失 (deficiency; deletion)

    ランダムに選ばれた遺伝子を削除する.

    https://gyazo.com/08df051074e613b2378560eb583d91c3



## New Generation Alternation Model

- 離散世代モデル

  全ての個体が一斉に繁殖を行い, 現世代集合全体が次世代集合に置き換えられるモデル.

  世代間における個体のオーバーラップが存在しない.

  - 単純GAモデル(simple GA)

    ルーレット選択と交叉・突然変異を用いて, 親世代と同数の子個体を生成し, 子個体のみを次世代として残す.

    初期収束による局所解の発生や, 進化的停滞が起こりやすい.

- 連続世代モデル

  現在の世代のうち一定の割合の個体だけを入れ替え, 残りはそのまま次世代に残すモデル.

  - 世代ギャップ(generation gap)

    離散世代モデルにおいて, 各世代の個体のうち次世代と入れ替えるものの割合.

  - 定常状態モデル(steady state)

    １世代につき１組（２個）の親子隊から子個体を生成し, 現世代のうち最も適応度の低い個体と入れ替える.

  - 世代間最小ギャップモデル(minimum generation gap; elitist recombination)

    ランダムに選択された親個体２個と, そこから作られる子個体２個を１つの「家族」とする.

    家族の中でエリート選択とルーレット選択により, ２個体を次世代に残す.

    これを家族の数だけで繰り返す.

    親子個体の選択を適応度を考慮せずにランダムに行うために, 多様性維持に優れており, 初期収束が起こりにくい.

    家族ないで選択を行うため, 計算負荷が軽く, 並列計算への適応もしやすい.

## Known Issues

- 初期収束

  最初の方の世代で偶然, 他の個体より適応度が圧倒時に高い個体が生じた場合, その個体の遺伝子が集団中に爆発的に増えて, 探索がかなり早い段階で収束してしまう現象.

  各パラメータを繰り返し設定し直してトライするしかない.

  {集団数を増やす;ランキングの選択確率を変更する; トーナメントサイズを縮小する; 突然変異率を増やす; 適用する問題に対して効果的となるよう, 突然変異操作を変更する}

  - 大変異

    予め定めた条件に応じて, 特定の世代においてのみ突然変異率を急激に高める方法.

    自然界における環境の激変(隕石の落下)に相当する.

    例えば, 通常1％に設定した突然変異率を, 100で割り切れる世代のみ50%とする.

  - 適応変異

    親個体間の不一致度合い(ハミング距離)に応じて, 生成された子個体の突然変異率を変化させる.

    https://gyazo.com/4f01b64a83b7675ccd2a7899792dd7f6

- ヒッチハイキング

  遺伝子操作時に最適解と一致しない遺伝子が混入してしまうことによって最適解の生成を妨げる現象.

  2点交叉で発生しやすい.

  例えば

  最適解: …1111<font color=ff0000>010</font>000…に対して

  親１ = …1111<font color=red>000</font>0000...

  親２ = …1111<font color=red>111</font>0000...

  が荒廃して最適解を得られる確率$p$は

  二点交叉の場合, $p = \frac{2}{L(L-1)}$

  遺伝子長が増加するにつれて, 加速度的に確率が低下する.

  しかし一様交叉であれば,

  $p = \frac{2}{2^3} =\frac{1}{4}$

  となり, 遺伝子長に依存しない.

## Summary

GAとは, 生物の遺伝を模したアルゴリズム. 適者生存による自然淘汰で最適解を探索することができる. 対象となる問題に関する数学的な知識がない場合でも適用が可能.

問題の性質に適したエンコーディングと交叉方法を選ぶことが重要. 組み合わせの増加などにより指数関数的に複雑さが増加する問題に対しても, 線型的な時間増加で探索を行うことができる.

局所最適解への収束を防ぐために, 状態に応じて突然変異の方法や, 確率, トーナメントサイズなどのパラメータを変えることも必要.

